# Глава 2 (Продължение). Проектиране на системата

## 2.6. Избор на технологии за изработка на хибридната система (Frontend)

За изграждането на потребителския интерфейс и API слоя на Контролния панел е избран съвременният технологичен стек, базиран на **Next.js** и **React**. Изборът е продиктуван от необходимостта от висока производителност, добра типова безопасност и възможност за хибридно рендиране.

### 2.6.1. Next.js и React Server Components (RSC)
Next.js е избран заради неговата архитектура, която позволява разделяне на логиката между сървъра и клиента по естествен начин чрез **RSC**.
*   **Производителност:** Сървърните компоненти позволяват извличане на данни директно от базата данни на Supabase, без да се излагат чувствителни ключове или да се увеличава обемът на JavaScript кода, изпращан към клиента [15].
*   **App Router:** Файлово-базираната система за маршрутизация улеснява изграждането на сложни административни табла (dashboards) с вложени оформления (layouts).
*   **API Routes:** Next.js служи и като бекенд за **CLI** инструмента. Чрез Edge Runtime крайните точки за автентикация и конфигурация са изключително бързи и мащабируеми.

### 2.6.2. TypeScript
Използването на TypeScript в целия проект (включително в монохранилището) осигурява строга типизация. Това е критично при манипулиране на сложни JSON обекти, които представляват инфраструктурните конфигурации. TypeScript предотвратява цели класове от логически грешки още по време на разработка.

### 2.6.3. Tailwind CSS и UI Компоненти
За стилизиране е избран **Tailwind CSS** [17]. Той позволява бързо и консистентно изграждане на интерфейса чрез ютилити класове. В комбинация с библиотеката **Radix UI** (чрез `shadcn/ui`), платформата постига висока степен на достъпност и професионален изглед с минимални усилия.

---

## 2.7. Избор на база данни и Backend-as-a-Service (Supabase)

За управление на състоянието и сигурността на платформата е избрана системата **Supabase**, която е изградена върху релационната база данни **PostgreSQL**.

### 2.7.1. PostgreSQL като източник на истината
Изборът на релационна база данни е от критично значение за Grape. Конфигурациите на инфраструктурата имат сложни връзки (потребител -> организация -> проект -> деплоймънт), които се управляват най-ефективно чрез SQL. PostgreSQL гарантира **ACID** трансакции, което е задължително при операции, засягащи облачни ресурси.

### 2.7.2. Row Level Security (RLS) и Сигурност
Едно от най-мощните предимства на Supabase е вграденият механизъм за **RLS** [16].
*   **Изолация:** Сигурността се дефинира директно в базата данни. Политиката "потребителят вижда само своите конфигурации" гарантира, че дори при грешка в интерфейсния слой, данните на клиентите остават изолирани.
*   **JWT Автентикация:** Системата използва JSON Web Tokens за оторизация на заявките от уеб портала и CLI инструмента.

### 2.7.3. Realtime и Поточни логове
За осигуряване на добро потребителско изживяване е необходима обратна връзка в реално време по време на деплоймънт.
*   **Приложение:** Когато Go Worker-ът записва логове от Terraform в таблицата `deployment_logs`, Supabase Realtime автоматично "избутва" тези промени към уеб браузъра на потребителя. Това позволява визуализиране на конзолния изход в реално време, без необходимост от презареждане на страницата.

---

## 2.8. Избор на технологии за изработка на сървъра (Go)

Сървърната логика на "Изпълнителния панел" (Execution Plane) е изцяло реализирана на езика **Go (Golang)**. Този избор е стратегически за Cloud Native инструменти.

### 2.8.1. Конкурентност и производителност
Go е проектиран за паралелно изпълнение. В Grape това се използва за едновременно управление на множество облачни ресурси.
*   **Goroutines:** Позволяват на работника да следи състоянието на клъстера, да стриймва логове и да комуникира с AWS API паралелно, използвайки минимални системни ресурси [13].

### 2.8.2. Статична компилация и преносимост
Go се компилира до единичен бинарен файл, който съдържа всички свои зависимости.
*   **Контейнеризация:** Това ни позволява да създаваме изключително малки и сигурни Docker изображения за нашите работници (Workers). Липсата на външни зависимости (като Python интерпретатор или Node.js runtime) намалява повърхността за атаки и ускорява времето за стартиране на контейнера.

### 2.8.3. Нативна интеграция с инфраструктурни инструменти
Тъй като Terraform, Kubernetes и Docker са написани на Go, езикът предлага най-добрите библиотеки за интеграция с тях.
*   **AWS SDK for Go v2:** Използва се за реализиране на сложните процеси по поемане на IAM роли и управление на OIDC доставчици.
*   **Go-Git:** Позволява на работника да манипулира инфраструктурния код директно в паметта или на ефимерния диск, преди да го изпрати към потребителското хранилище.

### 2.8.4. Архитектура на "Работника" (Worker)
Работниците са проектирани като "безсъстоятелни" (stateless). Те получават задача (Job) под формата на JSON, която съдържа всичко необходимо: URL на хранилището, конфигурационни параметри и ARN на IAM ролята. След като задачата приключи, работникът се изчиства, гарантирайки, че следващата задача започва "на чисто".
