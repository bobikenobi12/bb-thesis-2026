# Глава 2 (Продължение). Проектиране на системата

## 2.5. Избор на инструмент за контейнеризация

В архитектурата на Grape, контейнеризацията играе специфична роля, фокусирана върху сигурността и предвидимостта на изпълнителния процес. Избран е **Docker** като стандарт за тази цел, но неговото приложение е строго дефинирано в рамките на платформата.

### 2.5.1. Изолация на Изпълнителния панел (Execution Plane Isolation)
Основното предназначение на Docker в нашата система е да осигури изолирана ("стерилна") среда за работа на **Работниците (Workers)**. Тъй като платформата автоматично генерира и изпълнява Terraform код за множество различни клиенти, е недопустимо използването на споделена файлова система.

*   **Механизъм:** При всяка заявка за промяна (напр. потребител променя размера на клъстера в Web UI), системата стартира нов, ефимерен Docker контейнер.
*   **Съдържание:** Този контейнер ("Worker Image") съдържа предварително опаковани:
    *   **Terraform бинарни файлове:** Точната версия, с която са съвместими нашите шаблони.
    *   **Helm:** За управление на Kubernetes чартове.
    *   **AWS CLI:** За комуникация с облака.
    *   **Grape Worker (Go Binary):** Логиката, която изтегля шаблоните, попълва променливите и стартира процесите.
*   **Резултат:** Гарантира се, че генерирането на код за Клиент А е напълно изолирано от процесите на Клиент Б. Няма риск от "замърсяване" на средата или конфликт на версии.

*(Забележка: Платформата не се занимава с изграждането (build) на потребителските приложения. Потребителите са отговорни да предоставят своите Docker images чрез собствени CI процеси или публични регистри.)*

## 2.6. Избор на инструмент за оркестрация на контейнери

За управление на потребителските приложения и самата GitOps логика е избран **Kubernetes (Amazon EKS)** в комбинация с **ArgoCD**.

### 2.6.1. Kubernetes (EKS) като целева среда
Платформата провизира Amazon EKS клъстери за своите потребители. Изборът на управлявана услуга (Managed Service) вместо самостоятелна инсталация е ключов:
*   **Намалена оперативна тежест:** AWS поема грижата за Control Plane-а (etcd, API Server), което освобождава потребителя от сложна поддръжка.
*   **Стабилност:** Използването на EKS гарантира висока наличност и лесна интеграция с други AWS услуги (ALB, IAM).

### 2.6.2. ArgoCD и GitOps моделът
Тъй като потребителите на Grape не пишат инфраструктурния код ръчно (той се генерира от платформата), те се нуждаят от прозрачен механизъм за доставка на приложенията. Тук ролята на **ArgoCD** е фундаментална.

*   **Инсталация:** След като Worker-ът създаде клъстера, той автоматично инсталира ArgoCD.
*   **Наблюдение на генерираните хранилища:** ArgoCD се конфигурира да следи **GitOps хранилището**, което платформата автоматично попълва с манифести (напр. когато Worker-ът създаде RDS база, той записва данните за връзка във файл `infra-facts.yaml` и го push-ва в Git).
*   **Автоматизация:** ArgoCD засича промяната в Git и автоматично конфигурира приложението в клъстера да използва новата база данни. Това затваря цикъла на автоматизация, без потребителят да докосва `kubectl`.