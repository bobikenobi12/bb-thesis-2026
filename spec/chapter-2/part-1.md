# Глава 2. ПРОЕКТИРАНЕ НА СИСТЕМАТА

## 2.1. Функционални изисквания към хибридната система

Проектирането на хибридна система за оркестрация изисква дефинирането на ясни функционални граници, които да адресират нуждите както на разработчиците, така и на оперативните инженери. Основната цел е намаляване на когнитивното натоварване чрез изграждане на "златни пътеки" (golden paths) за разгръщане на инфраструктура [14].

Функционалните изисквания към платформата "Grape" са разделени в следните категории:

### 2.1.1. Управление на инфраструктурата като код (IaC)
Системата трябва да позволява декларативно описание на ресурси в **AWS**. Потребителят не трябва да взаимодейства директно с облачната конзола за рутинни задачи. Платформата трябва автоматично да генерира и изпълнява **Terraform** конфигурации на базата на високоуровневи параметри, зададени от потребителя [7].

### 2.1.2. Сигурност и делегиран достъп (Zero-Key Security)
Критично изискване е елиминирането на статичните секрети. Системата трябва да реализира механизъм за поемане на роли (AssumeRole), използвайки временни кредити за достъп. Това гарантира, че платформата не съхранява постоянни административни ключове за потребителските акаунти, което значително намалява риска от компрометиране.

### 2.1.3. Интеграция с GitOps работни потоци
Всеки проект в платформата трябва да бъде обвързан с Git хранилище. Системата трябва автоматично да разпознава промени в кода (през Webhooks) и да задейства съответните **CI/CD** процеси. Инфраструктурното състояние трябва да бъде версионирано и одитируемо [10].

### 2.1.4. Хибриден интерфейс за управление
Потребителите трябва да имат достъп до два основни интерфейса:
1.  **CLI:** За бърза инициализация, локална диагностика и автоматизация на задачи през терминала.
2.  **Web GUI:** Централизиран портал за визуализация на текущото състояние, преглед на логове от внедрявания и управление на екипни политики.

---

## 2.2. Блокова схема на проекта и обстойно обяснение

Архитектурният дизайн на Grape е изграден на модулен принцип, разделяйки логиката на три независими равнини (planes). Този подход осигурява висока наличност, сигурност и възможност за независимо скалиране на компонентите.

> **Предложение за фигура:** Архитектурна блокова схема, илюстрираща взаимодействието между Control Plane (SaaS), Execution Plane (Workers) и User Data Plane (AWS Account).
> *Фигура 2.1. Блокова схема на хибридната архитектура за оркестрация.*

### 2.2.1. Централизиран контролен панел (Control Plane)
Контролният панел е изграден като **SPA** приложение чрез **Next.js**, подкрепено от **BaaS** решението **Supabase**. Той служи като единствена входна точка (Entry Point) за API заявки от **CLI** инструмента и уеб потребителите.
*   **Управление на състоянието:** Базата данни съхранява конфигурационните шаблони, метаданните за проектите и историята на всички деплоймънти.
*   **Автентикация:** Използва се **JWT** и **RLS** за гарантиране на изолация между различните организации и потребители [16].

### 2.2.2. Равнина на изпълнение (Execution Plane)
Това е слоят, в който се извършва реалната работа по провизиране на ресурси. Вместо локално изпълнение на **IaC** скриптове, Grape използва флотилия от работници (Workers), написани на **Go**.
*   **Изолация:** Всеки работник се стартира в отделен ефимерен контейнер. Това предотвратява конфликта на зависимости и гарантира, че артефактите от един проект не са достъпни за друг.
*   **Комуникация:** Работниците приемат задачи през опашка от съобщения, изтеглят необходимите Git хранилища, изпълняват Terraform плана и връщат логове в реално време към Control Plane-а.

### 2.2.3. Потребителски облачен сегмент (Data Plane)
Този компонент се намира изцяло в инфраструктурата на клиента. Grape не "притежава" ресурсите, а само ги управлява.
*   **IAM Trust:** Връзката се установява чрез CloudFormation скрипт, който създава роля с доверие към SaaS акаунта на Grape.
*   **Runtime:** Тук се разполагат **K8s** клъстерите (**EKS**), управлявани чрез **ArgoCD**, който синхронизира приложенията на базата на "Infra Facts", генерирани от Execution Plane-а [5].

Тази трислойна архитектура позволява на Grape да функционира като мост между намеренията на разработчика (описани в Git или Web UI) и реалното им физическо проявление в облака.
